## –ù–∞—á–∞–ª—å–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ - —Å–æ–∑–¥–∞–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–∞

–°–æ–∑–¥–∞–µ–º –ø–∞–ø–∫—É —Å –ø—Ä–æ–µ–∫—Ç–æ–º –Ω–∞ –≥–∏—Ç—Ö–∞–±–µ. 

–î–æ–±–∞–≤–∏–ª –ø–∏—Ç–æ–Ω–æ–≤—Å–∫–∏–π gitignore –∏ MIT –ª–∏—Ü–µ–Ω–∑–∏—é.

<img width="882" height="789" alt="image" src="https://github.com/user-attachments/assets/a90678fa-88cc-4105-ae90-f6417be3525a" />

–°–æ–∑–¥–∞—é –ª–æ–∫–∞–ª—å–Ω—É—é –ø–∞–ø–∫—É –Ω–∞ —Å–≤–æ–µ–º –∫–æ–º–ø—å—é—Ç–µ—Ä–µ, –Ω–∞–ø—Ä–∏–º–µ—Ä `C:\Users\erohi\Desktop\de_project`

–û—Ç–∫—Ä—ã–≤–∞—é —Ç–µ—Ä–º–∏–Ω–∞–ª –∏ –ø–µ—Ä–µ—Ö–æ–∂—É –≤ –ø–∞–ø–∫—É `cd C:\Users\erohi\Desktop\de_project`

–ö–ª–æ–Ω–∏—Ä—É—é —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π `git clone git@github.com:erohin94/pet_project_earthquake.git`

<img width="1237" height="546" alt="image" src="https://github.com/user-attachments/assets/500dd782-ab81-4b35-9b6b-e4dc7cf02b85" />

<img width="763" height="147" alt="image" src="https://github.com/user-attachments/assets/30ff7da1-1f9b-4986-9f20-86327b918f0d" />

–í–∏–¥–∏–º –∫–∞–∫ —É–¥–∞–ª–µ–Ω–Ω—ã–π—Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π —Å–∫–ª–æ–Ω–∏—Ä–æ–≤–∞–ª—Å—è –≤ –ª–æ–∫–∞–ª—å–Ω—É—é –ø–∞–ø–∫—É.

<img width="621" height="154" alt="image" src="https://github.com/user-attachments/assets/c99a0e74-63de-4994-ba95-3ffe80795ded" />

## –ü—Ä–æ–≤–µ—Ä—è—é —Ä–∞–±–æ—Ç–æ—Å–ø–æ—Å–æ–±–Ω–æ—Å—Ç—å –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ –∏ —É–¥–∞–ª–µ–Ω–Ω–æ–≥–æ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è.

–ü—Ä–æ–≤–µ—Ä—è—é –≤–µ—Ä—Å–∏—é git `git --version`

<img width="386" height="32" alt="image" src="https://github.com/user-attachments/assets/00827df4-81f2-43e4-bbb3-927eba29df32" />

–ó–∞–¥–∞—é –∏–º—è –ø–æ–ª—å–∑–ª–≤–∞—Ç–µ–ª—è –∏ –ø–æ—á—Ç—É, –¥–∞–ª–µ–µ –¥–µ–ª–∞—é –ø—Ä–æ–≤–µ—Ä–∫—É

```
git config --global user.name "–í–∞—à–µ –∏–º—è"
git config --global user.email "email@domain.com"

git config user.email
git config user.name
```

<img width="686" height="147" alt="image" src="https://github.com/user-attachments/assets/4d228749-c507-49b3-8577-66253c14aadd" />

–°–æ–∑–¥–∞—é –ª–æ–∫–∞–ª—å–Ω–æ —Ç–µ—Å—Ç–æ–≤—ã–π —Ñ–∞–π–ª `test_file.txt`

<img width="622" height="194" alt="image" src="https://github.com/user-attachments/assets/18dfb0b7-1585-4962-a24c-7dc0822c5f35" />

–ü—Ä–æ–±—É—é –µ–≥–æ –æ—Ç–ø—Ä–∞–≤–∏—Ç—å –≤ —É–¥–∞–ª–µ–Ω–Ω—ã–π —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π, –Ω–æ –ø–µ—Ä–µ–¥ –æ—Ç–ø—Ä–∞–≤–∫–æ–π, –µ—Å–ª–∏ –≤ —É–¥–∞–ª–µ–Ω–Ω–æ–º —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏ –±—ã–ª–∏ –∫–∞–∫–∏–µ –ª–∏–±–æ –∏–∑–º–µ–Ω–µ–Ω–∏—è, –∏—Ö –Ω–∞–¥–æ —Å–Ω–∞—á–∞–ª–∞ –¥–æ–±–∞–≤–∏—Ç—å –≤ –ª–æ–∫–∞–ª—å–Ω—ã–π.

–°–Ω–∞—á–∞–ª–∞ –ø–æ–¥—Ç—è–≥–∏–≤–∞–µ–º –∏–∑–º–µ–Ω–µ–Ω–∏—è —Å —É–¥–∞–ª—ë–Ω–Ω–æ–≥–æ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è: `git pull origin main`

<img width="700" height="213" alt="image" src="https://github.com/user-attachments/assets/ffc16e18-8199-4317-85a8-18617b338261" />

–î–æ–±–∞–≤–∏—Ç—å —Ñ–∞–π–ª—ã: `git add .`

–°–¥–µ–ª–∞—Ç—å –∫–æ–º–º–∏—Ç: `git commit -m "–¢–µ—Å—Ç–æ–≤—ã–π –∫–æ–º–º–∏—Ç"`

<img width="737" height="101" alt="image" src="https://github.com/user-attachments/assets/c3c46477-aa5b-43da-9974-e1c46a848d0d" />

–ó–∞—Ç–µ–º –ø—É—à–∏–º: `git push origin main`

<img width="617" height="165" alt="image" src="https://github.com/user-attachments/assets/a6e44861-6c3b-40de-b3b0-f2eafbeda88b" />

–ö–∞–∫ –≤–∏–¥–∏–º, —Ñ–∞–π–ª –¥–æ–±–∞–≤–ª–µ–Ω –≤ —É–¥–∞–ª–µ–Ω–Ω—ã–π —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π.

<img width="1309" height="396" alt="image" src="https://github.com/user-attachments/assets/6776b1a3-feeb-4a0c-9d96-140827d946a6" />

## –°–æ–∑–¥–∞–Ω–∏–µ –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–≥–æ –æ–∫—Ä—É–∂–µ–Ω–∏—è

–û—Ç–∫—Ä—ã–≤–∞—é VS Code –∏ —Å–æ–∑–¥–∞—é –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–µ –æ–∫—Ä—É–∂–µ–Ω–∏–µ: `python -m venv venv`

–ê–∫—Ç–∏–≤–∏—Ä—É—é –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–µ –æ–∫—Ä—É–∂–µ–Ω–∏–µ: `venv\Scripts\activate`

<img width="851" height="181" alt="image" src="https://github.com/user-attachments/assets/96c9049f-54cf-45c4-9f53-ef8511eac1e9" />

–ö–∞–∫ –≤–∏–¥–Ω–æ, –Ω–∞ —Ç–µ–∫—É—â–∏–π –º–æ–º–µ–Ω—Ç –∞–±—Å–æ–ª—é—Ç–Ω–æ –ø—É—Å—Ç–æ–µ –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–µ –æ–∫—Ä—É–∂–µ–Ω–∏–µ

<img width="578" height="88" alt="image" src="https://github.com/user-attachments/assets/e66c1507-8288-405d-a62d-294075f94a8c" />

## –†–∞–∑–≤–æ—Ä–∞—á–∏–≤–∞–Ω–∏–µ –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—ã

–í services –≤ .yaml —Ñ–∞–π–ª–µ –±—ã–ª–∏ –¥–æ–±–∞–≤–ª–µ–Ω—ã —Å–µ—Ä–≤–∏—Å—ã postgres_dwh, minio, metabase

–¢–∞–∫ –∂–µ –≤ –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é `_PIP_ADDITIONAL_REQUIREMENTS: ${_PIP_ADDITIONAL_REQUIREMENTS:-duckdb}` –±—ã–ª –¥–æ–±–∞–≤–ª–µ–Ω `duckdb`. –ü–æ–Ω–∞–¥–æ–±–∏—Ç—Å—è –¥–∞–ª–µ–µ. –ë–µ–∑ –Ω–µ–≥–æ –±—É–¥–µ—Ç –æ—à–∏–±–∫–∞ –≤ UI Airflow.

<img width="803" height="260" alt="image" src="https://github.com/user-attachments/assets/b452b61d-e789-4a37-b8e1-3cc94eeb8525" />

–í–æ–∑–Ω–∏–∫–∞–µ—Ç –∏–∑ –∑–∞ —Ç–æ–≥–æ —á—Ç–æ, —É –º–µ–Ω—è Airflow –∏–∑–æ–ª–∏—Ä–æ–≤–∞–Ω, —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ –æ–Ω –Ω–µ –∑–Ω–∞–µ—Ç –æ –º–æ–µ–º –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–º –æ–∫—Ä—É–∂–µ–Ω–∏–∏ venv, –∏ —Ç–æ —á—Ç–æ —è —É—Å—Ç–∞–Ω–≤–∞–ª–∏–≤–∞—é –≤ –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–µ –æ–∫—Ä—É–∂–µ–Ω–∏–µ venv, –Ω–∞–ø—Ä–∏–º–µ—Ä —É—Å—Ç–∞–Ω–æ–≤–∏–ª –≤ venv –º–æ–¥—É–ª—å duckdb (–¥–∞–ª–µ–µ –±—É–¥–µ—Ç –æ–ø–∏—Å–∞–Ω–æ –ø—Ä–æ —É—Å—Ç–∞–Ω–æ–≤–∫—É).
Airflow –≤ –¥–æ–∫—Ä–µ –Ω–µ –∑–Ω–∞–µ—Ç –æ–± —ç—Ç–æ–º, –ø–æ—ç—Ç–æ–º—É –Ω–∞–º –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –ø—Ä–æ–ø–∏—Å–∞—Ç—å –≤ `_PIP_ADDITIONAL_REQUIREMENTS: ${_PIP_ADDITIONAL_REQUIREMENTS:-duckdb}` –≤—Å–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏, –∫–æ—Ç–æ—Ä—ã–µ –¥–æ–ª–∂–Ω—ã –±—ã—Ç—å —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã –≤–Ω—É—Ç—Ä–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞. –≠—Ç–æ –≥–∞—Ä–∞–Ω—Ç–∏—Ä—É–µ—Ç, —á—Ç–æ DAG –∏ –∑–∞–¥–∞—á–∏ —Å–º–æ–≥—É—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ –ø–∞–∫–µ—Ç—ã –±–µ–∑ –æ—à–∏–±–æ–∫ –∏–º–ø–æ—Ä—Ç–∞.  

–í—ã–ø–æ–ª–Ω—è—é –∫–æ–º–∞–Ω–¥—É: `docker-compose up -d`

–ü—Ä–æ–≤–µ—Ä—è—é: `docker ps`

–ö–∞–∫ –≤–∏–¥–Ω–æ —Å–µ—Ä–≤–∏—Å—ã —Å—Ç–∞—Ä—Ç–∞–Ω—É–ª–∏

<img width="1862" height="208" alt="image" src="https://github.com/user-attachments/assets/2bd9ee89-f7f5-4178-872d-d980e7153c9e" />

–í –ª–æ–∫–∞–ª—å–Ω–æ–π –¥–∏—Ä–µ–∫—Ç–æ—Ä–∏–∏ –±—ã–ª–∏ —Å–æ–∑–¥–∞–Ω—ã –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–∞–ø–∫–∏: dags, logs –∏ —Ç–¥

<img width="623" height="359" alt="image" src="https://github.com/user-attachments/assets/8a61e056-80d2-4ae2-af6e-af4597c5c76d" />

## –ó–∞–ø—É—Å–∫ Airflow

–ß—Ç–æ–±—ã —É–≤–∏–¥–µ—Ç—å –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å Airflow, –æ—Ç–∫—Ä—ã—Ç—å –±—Ä–∞—É–∑–µ—Ä –∏ –ø–µ—Ä–µ–π—Ç–∏ –ø–æ –∞–¥—Ä–µ—Å—É http://127.0.0.1:8080/

–ï—Å–ª–∏ –≤—Å–µ –ø—Ä–æ—à–ª–æ –ø–æ –ø–ª–∞–Ω—É, —Ç–æ –ø–æ—è–≤–∏—Ç—Å—è –æ–∫–Ω–æ –¥–ª—è –≤–≤–æ–¥–∞ –∏–º–µ–Ω–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏ –ø–∞—Ä–æ–ª—è. –í–≤–æ–¥–∏–º –≤ –æ–±–∞ –æ–∫–æ—à–∫–∞ airflow –∏ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–∞–µ–º.

<img width="1898" height="372" alt="image" src="https://github.com/user-attachments/assets/8d3ef726-4098-4459-b222-6ad2679aac5d" />

## –ó–∞–ø—É—Å–∫ Minio

–ß—Ç–æ–±—ã —É–≤–∏–¥–µ—Ç—å –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å Minio, –æ—Ç–∫—Ä—ã—Ç—å –±—Ä–∞—É–∑–µ—Ä –∏ –ø–µ—Ä–µ–π—Ç–∏ –ø–æ –∞–¥—Ä–µ—Å—É http://127.0.0.1:9001

–í–æ–π—Ç–∏ –≤ UI –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å —Å —É—á–µ—Ç–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è. –í–≤–æ–¥–∏–º –≤ –æ–±–∞ –æ–∫–æ—à–∫–∞ minioadmin

<img width="1890" height="336" alt="image" src="https://github.com/user-attachments/assets/f542816e-7023-45d4-8104-f4564298369d" />

–°–æ–∑–¥–∞–µ–º –±–∞–∫–µ—Ç

<img width="1893" height="660" alt="image" src="https://github.com/user-attachments/assets/4dc88c72-208b-4994-97d3-6531fe937c48" />

–°–æ—Ö—Ä–∞–Ω—è–µ–º –∫–ª—é—á–∏ –∫–æ—Ç–æ—Ä—ã–µ –±—É–¥–µ–º –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –¥–ª—è –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ –±–∞–∫–µ—Ç—É.

<img width="1893" height="792" alt="image" src="https://github.com/user-attachments/assets/f0d49609-bf00-4a04-8e3c-97491255fa52" />

<img width="1156" height="646" alt="image" src="https://github.com/user-attachments/assets/b0dc8851-2884-4f23-87bb-1c27b6c9111a" />

–°–æ–∑–¥–∞—é —Ñ–∞–π–ª–∏–∫ cred.py –≤ –∫–æ—Ç–æ—Ä–æ–º –±—É–¥—É—Ç –∫–ª—é—á–∏. –í –≥–∏—Ç —Ö—Ä–∞–Ω–∏—Ç—å –µ–≥–æ –Ω–µ –±—É–¥–µ–º.

<img width="938" height="389" alt="image" src="https://github.com/user-attachments/assets/20401d17-14f0-4e5c-bd94-602122ade746" />

–í —Ä–∞–º–∫–∞—Ö S3 access –∫–ª—é—á –º–æ–∂–Ω–æ –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å –∏ –æ–Ω –Ω–∏–∫–∞–∫ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç –±–µ–∑ —Å–µ–∫—Ä–µ—Ç–Ω–æ–≥–æ –∫–ª—é—á–∞.

–í data —É –Ω–∞—Å —Å–µ–π—á–∞—Å –Ω–∞—á–∞–ª–∏ –∑–∞–ø–∏—Å—ã–≤–∞—Ç—å—Å—è –º–µ—Ç–∞ —Ñ–∞–π–ª—ã, –µ–≥–æ –≤–µ—Ä—Å–∏–æ–Ω–∏—Ä–æ–≤–∞—Ç—å –Ω–µ –±—É–¥–µ–º, –ø–æ—ç—Ç–æ–º—É –¥–æ–±–∞–≤–∏–º –≤ .gitignore

–û—Ç–∫—Ä—ã–≤–∞—é .gitignore –∏ –≤ –∫–æ–Ω—Ü–µ –ø—Ä–æ–ø–∏—Å—ã–≤–∞—é

```
#Project
data/
logs/
cred.py
```

–≠—Ç–∏ —Ñ–∞–π–ª—ã —Ç–µ–ø–µ—Ä—å –Ω–µ –±—É–¥—É—Ç –¥–æ–±–∞–≤–ª—è—Ç—å—Å—è –≤ —É–¥–∞–ª–µ–Ω–Ω—ã–π —Ä–µ–ø–æ –Ω–∞ –≥–∏—Ç—Ö–∞–±

## –ó–∞–ø—É—Å–∫ Metabase

Metabase: http://localhost:3000

## –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ PostgreSQL

<img width="980" height="809" alt="image" src="https://github.com/user-attachments/assets/2cbc983f-2be3-4507-96c6-145e7bd968b5" />

## –°–æ–∑–¥–∞–Ω–∏–µ –ø–µ—Ä–≤–æ–≥–æ DAG

–ü–µ—Ä–≤—ã–π –¥–∞–≥ –±—É–¥–µ—Ç –≥—Ä—É–∑–∏—Ç—å —Å—ã—Ä—ã–µ –¥–∞–Ω–Ω—ã–µ –∏–∑ API –∏ —Å–∫–ª–∞–¥—ã–≤–∞—Ç—å –≤ S3 `raw_from_api_to_s3.py`

Airflow —Å–µ–π—á–∞—Å —Ä–∞–±–æ—Ç–∞–µ—Ç –≤ –¥–æ–∫–µ—Ä–µ, —É –¥–æ–∫–µ—Ä–∞ –µ—Å—Ç—å —Å–≤–æ–µ –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–µ –æ–∫—Ä—É–∂–µ–Ω–∏–µ –∫–æ—Ç–æ—Ä–æ–µ –∏–∑–æ–ª–∏—Ä–æ–≤–∞–Ω–æ –æ—Ç –º–æ–µ–≥–æ –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ –∫–æ–º–ø—å—é—Ç–µ—Ä–∞.

–í –º–æ–µ–º –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–º –æ–∫—Ä—É–∂–µ–Ω–∏–∏ venv —Å–µ–π—á–∞—Å —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω —Ç–æ–ª—å–∫–æ pip.

–ß—Ç–æ–±—ã —Å—Ä–∞–≤–Ω—è—Ç—å –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–µ –æ–∫—Ä—É–∂–µ–Ω–∏–µ –º–µ–∂–¥—É Airflow –∏ –º–æ–µ–π –ª–æ–∫–∞–ª—å–Ω–æ–π –º–∞—à–∏–Ω–æ–π, –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ —Å–∫–∞—á–∞—Ç—å –ø–∞–∫–µ—Ç –≤ –º–æ–µ –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–µ –æ–∫—Ä—É–∂–µ–Ω–∏–µ –∫–æ—Ç–æ—Ä–æ–µ –∑–∞–ø—É—â–µ–Ω–æ –≤ VsCode.

–ü—Ä–æ–ø–∏—Å—ã–≤–∞—é –≤ –ø–æ–∏—Å–∫–æ–≤–∏–∫–µ pipy apache airflow –∏ —Å–∫–∞—á–∏–≤–∞—é –≤–µ—Ä—Å–∏—é 2.10.5 [—Å—Å—ã–ª–∫–∞](https://pypi.org/project/apache-airflow/#history)

<img width="584" height="99" alt="image" src="https://github.com/user-attachments/assets/608ba9d6-5004-45ba-a5ff-38dc7c257d17" />

–ï—Å–ª–∏ —Å–µ—á–∞—Å –≤ .py —Ñ–∞–π–ª–µ –ø—Ä–æ–ø–∏—Å–∞—Ç—å `from airflow import DAG`, —Ç–æ —É–≤–∏–¥–∏–º –ø–æ–¥—á–µ—Ä–∫–∏–≤–∞–Ω–∏–µ

<img width="203" height="26" alt="image" src="https://github.com/user-attachments/assets/d03e4540-5d18-48d3-9900-417c6832d1c2" />

–≠—Ç–æ –≥–æ–≤–æ—Ä–∏—Ç –æ —Ç–æ–º —á—Ç–æ –¥–∞–Ω–Ω–æ–µ –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–µ –æ–∫—Ä—É–∂–µ–Ω–∏–µ –Ω–µ –∑–Ω–∞–µ—Ç —á—Ç–æ —Ç–∞–∫–æ–µ Airflow –∏ —á—Ç–æ —Ç–∞–∫–æ–µ DAG. 

–î–ª—è —ç—Ç–æ–≥–æ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º: `pip install apache-airflow==2.10.5` –≤ –Ω–∞—à–µ –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–µ –æ–∫—Ä—É–∂–µ–Ω–∏–µ.

–¢–µ–ø–µ—Ä—å –ø–æ—Å–ª–µ —É—Å—Ç–∞–Ω–æ–≤–∫–∏, –µ—Å–ª–∏ –≤—ã–¥–µ–ª–∏—Ç—å DAG –≤ –∏–º–ø–æ—Ä—Ç–µ –∏ –Ω–∞–∂–∞—Ç—å CTRL —Ç–æ –±—É–¥–µ—Ç –≤–∏–¥–Ω–∞ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è.

<img width="825" height="322" alt="image" src="https://github.com/user-attachments/assets/86218e23-0c7a-44b0-ac27-3e1b409e2674" />

–¢–∞–∫ –∂–µ –º–æ–∂–Ω–æ –∏ –ø—Ä–æ–≤–∞–ª–∏—Ç—Å—è –≤ airflow.

*(–ò–∑–Ω–∞—á–∞–ª—å–Ω–æ –ø—Ä–∏ –Ω–∞–≤–µ–¥–µ–Ω–∏–∏ –Ω–∞ DAG, –Ω–µ —É–¥–∞–≤–∞–ª–æ—Å—å –≤–∏–¥–µ—Ç—å –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é, —Ç–∞–∫ –∫–∞–∫ –≤ VS‚ÄØCode –Ω–µ –±—ã–ª –≤—ã–±—Ä–∞–Ω –∏–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∞—Ç–æ—Ä Python –¥–ª—è –ø—Ä–æ–µ–∫—Ç–∞.
–ò–∑-–∑–∞ —ç—Ç–æ–≥–æ Pylance –∏ Intellisense –ø–æ–∫–∞–∑—ã–≤–∞–ª–∏ Any, –ø–æ—Ç–æ–º—É —á—Ç–æ –æ–Ω–∏ –Ω–µ –≤–∏–¥–µ–ª–∏ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ –ø–∞–∫–µ—Ç—ã –≤ –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–º –æ–∫—Ä—É–∂–µ–Ω–∏–∏.
–ü–æ—Å–ª–µ –≤—ã–±–æ—Ä–∞ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–≥–æ –∏–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∞—Ç–æ—Ä–∞ Python (–≤ –º–æ—ë–º —Å–ª—É—á–∞–µ venv –ø—Ä–æ–µ–∫—Ç–∞) –∞–≤—Ç–æ–¥–æ–ø–æ–ª–Ω–µ–Ω–∏–µ –∏ docstring –¥–ª—è DAG –Ω–∞—á–∞–ª–∏ —Ä–∞–±–æ—Ç–∞—Ç—å –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ.)*

–¢–∞–∫ –∂–µ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—é duckdb [—Å—Å—ã–ª–∫–∞](https://pypi.org/project/duckdb/1.2.2/)

–°—Ç–∞–≤–ª—é –≤–µ—Ä—Å–∏—é: `pip install duckdb==1.2.2`

–ü–∏—à—É –∫–æ–¥ –≤ `raw_from_api_to_s3.py`

```
def get_dates(**context) -> tuple[str, str]:
    """"""
    start_date = context["data_interval_start"].format("YYYY-MM-DD")
    end_date = context["data_interval_end"].format("YYYY-MM-DD")

    return start_date, end_date
```

–§—É–Ω–∫—Ü–∏—è `get_dates(**context)` –ø—Ä–∏–Ω–∏–º–∞–µ—Ç –≤ —Å–µ–±—è –∞—Ç—Ä–∏–±—É—Ç –≤ –≤–∏–¥–µ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞. –ö–æ–Ω—Ç–µ–∫—Å—Ç —ç—Ç–æ –æ—Å–Ω–æ–≤–Ω–∞—è –∫–æ–Ω—Ü–µ–ø—Ü–∏—è –≤ Airflow, –∫–æ—Ç–æ—Ä–∞—è —Ö—Ä–∞–Ω–∏—Ç –≤ —Å–µ–±–µ –∫—É—á—É —Ä–∞–∑–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏. –≠—Ç–æ —Å–ª–æ–≤–∞—Ä—å —Å–æ –≤—Å–µ–π —Å–ª—É–∂–µ–±–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π –æ —Ç–µ–∫—É—â–µ–º –∑–∞–ø—É—Å–∫–µ DAG –∏ –∑–∞–¥–∞—á–∏, –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–µ—Ä–µ–¥–∞–≤–∞–µ–º—ã–π Airflow –≤ –∫–∞–∂–¥—É—é –∑–∞–¥–∞—á—É.

–ü—Ä–∏–º–µ—Ä–Ω–æ –≤–æ—Ç —Ç–∞–∫ –≤—ã–≥–ª—è–¥–∏—Ç context. –ï—Å–ª–∏ –±—ã –Ω–∞–ø–µ—á–∞—Ç–∞–ª –µ–≥–æ –≤ `PythonOperator`:

```
def my_task(**context):
    print(context)
```

–¢–æ –≤–Ω—É—Ç—Ä–∏ –±—ã–ª–æ –±—ã —á—Ç–æ-—Ç–æ —Ç–∏–ø–∞:

```
{
  'ds': '2025-11-23',
  'ts': '2025-11-23T00:00:00+00:00',
  'data_interval_start': DateTime(2025, 11, 22),
  'data_interval_end': DateTime(2025, 11, 23),
  'dag_run': <DagRun ...>,
  'task': <Task ...>,
  'run_id': 'scheduled__2025-11-23T00:00:00Z',
  'ti': <TaskInstance>,
  ...
}
```

–≠—Ç–æ –ø—Ä–æ—Å—Ç–æ –Ω–∞–±–æ—Ä –≥–æ—Ç–æ–≤—ã—Ö –∑–Ω–∞—á–µ–Ω–∏–π, –∫–æ—Ç–æ—Ä—ã–µ Airflow –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç.

–í –¥–∞–Ω–Ω–æ–º –¥–∞–≥–µ –∏—Å–ø–æ–ª—å–∑—É—é —Ñ—É–Ω–∫—Ü–∏—é get_dates(**context) —á—Ç–æ–±—ã –¥–æ—Å—Ç–∞–≤–∞—Ç—å –∏–Ω—Ñ—É –æ —Ç–µ–∫—É—â–µ–º –∑–∞–ø—É—Å–∫–µ –¥–∞–≥, –∞ –∏–º–µ–Ω–Ω–æ –¥–∞—Ç—É –Ω–∞—á–∞–ª–∞ –∑–∞–ø—É—Å–∫–∞ –∏ –¥–∞—Ç—É –∫–æ–Ω—Ü–∞ –∑–∞–ø—É—Å–∫–∞, –∫–æ—Ç–æ—Ä—ã–µ –∏—Å–ø–æ–ª—å–∑—É—é –≤ –¥–∞–ª—å–Ω–µ–π—à–µ–º.

–ö–æ–Ω—Ç–µ–∫—Å—Ç —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –≤ 100% —Å–ª—É—á–∞–µ–≤, –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è –∏–¥–µ–º–ø–æ—Ç–µ–Ω—Ç–Ω–æ—Å—Ç–∏. 

**–ò–¥–µ–º–ø–æ—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å (idempotency)** ‚Äî —ç—Ç–æ —Å–≤–æ–π—Å—Ç–≤–æ –æ–ø–µ—Ä–∞—Ü–∏–∏, –ø—Ä–∏ –∫–æ—Ç–æ—Ä–æ–º –ø–æ–≤—Ç–æ—Ä–Ω—ã–π –∑–∞–ø—É—Å–∫ –¥–∞—ë—Ç —Ç–æ—Ç –∂–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç, —á—Ç–æ –∏ –ø–µ—Ä–≤—ã–π, –∏ –Ω–µ –ø—Ä–∏–≤–æ–¥–∏—Ç –∫ –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–º –∏–∑–º–µ–Ω–µ–Ω–∏—è–º.

–¢–∞–∫ –∂–µ –≤ —Å–∫—Ä–∏–ø—Ç–µ –∏—Å–ø–æ–ª—å–∑—É—é –∫–æ–º–∞–Ω–¥—É `COPY TO`

```
COPY
        (
            SELECT
                *
            FROM
                read_csv_auto('https://earthquake.usgs.gov/fdsnws/event/1/query?format=csv&starttime={start_date}&endtime={end_date}') AS res
        ) TO 's3://prod/{LAYER}/{SOURCE}/{start_date}/{start_date}_00-00-00.gz.parquet';
```

–≠—Ç–æ –¥–æ–≤–æ–ª—å–Ω–æ –ø—Ä–æ—Å—Ç–∞—è –∫–æ–º–∞–Ω–¥–∞, –æ—Ç –∫—É–¥–∞ —Å–∫–æ–ø–∏—Ä–æ–≤–∞–ª COPY –∏ –∫—É–¥–∞ –≤—Å—Ç–∞–≤–∏–ª TO, –≤ –¥–∞–Ω–Ω–æ–º —Å–ª—É—á–∞–µ –±–µ—Ä—É –¥–∞–Ω–Ω—ã–µ –∏–∑ –∞–ø–∏ –∏ –≤—Å—Ç–∞–≤–ª—è—é –≤ –±–∞–∫–µ—Ç S3

–ü–æ–ª–Ω–æ—Å—Ç—å—é –∫–æ–¥ –¥–∞–≥–∞

```
import logging # –í—Å—Ç—Ä–æ–µ–Ω–Ω—ã–π –º–æ–¥—É–ª—å Python –¥–ª—è –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—è

import duckdb # –°–æ–∑–¥–∞—é In-Memory –ë–î
import pendulum # –î–ª—è —Ä–∞–±–æ—Ç—ã —Å –¥–∞—Ç–∞–º–∏
from airflow import DAG
from airflow.models import Variable
from airflow.operators.empty import EmptyOperator
from airflow.operators.python import PythonOperator

# –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è DAG
OWNER = "e.erokhin"
DAG_ID = "raw_from_api_to_s3"

# –ò—Å–ø–æ–ª—å–∑—É–µ–º—ã–µ —Ç–∞–±–ª–∏—Ü—ã –≤ DAG
LAYER = "raw"
SOURCE = "earthquake"

# S3
# –≠—Ç–∞ –∫–æ–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –Ω—É–∂–Ω–∞, —á—Ç–æ–±—ã —á–∏—Ç–∞—Ç—å –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ, –∫–æ—Ç–æ—Ä—ã–µ —Ö—Ä–∞–Ω—è—Ç—Å—è –Ω–µ –≤ –∫–æ–¥–µ, –∞ –≤ Airflow UI / Airflow metadata DB.
ACCESS_KEY = Variable.get("access_key") # –≠—Ç–æ —Ç–æ —á—Ç–æ —è –ø—Ä–æ–ø–∏—Å—ã–≤–∞—é –≤ Admin->Variables –≤ UI Airflow.
SECRET_KEY = Variable.get("secret_key") # –≠—Ç–æ —Ç–æ —á—Ç–æ —è –ø—Ä–æ–ø–∏—Å—ã–≤–∞—é –≤ Admin->Variables –≤ UI Airflow

LONG_DESCRIPTION = """
# LONG DESCRIPTION
"""

SHORT_DESCRIPTION = "SHORT DESCRIPTION"

args = {
    "owner": OWNER,
    "start_date": pendulum.datetime(2025, 11, 20, tz="Europe/Moscow"),
    "catchup": True,
    "retries": 3,
    "retry_delay": pendulum.duration(hours=1),
}


def get_dates(**context) -> tuple[str, str]:
    """"""
    start_date = context["data_interval_start"].format("YYYY-MM-DD")
    end_date = context["data_interval_end"].format("YYYY-MM-DD")

    return start_date, end_date


def get_and_transfer_api_data_to_s3(**context):
    """"""

    start_date, end_date = get_dates(**context)
    logging.info(f"üíª Start load for dates: {start_date}/{end_date}")
    con = duckdb.connect()

    con.sql(
        f"""
        SET TIMEZONE='UTC';
        INSTALL httpfs;
        LOAD httpfs;
        SET s3_url_style = 'path';
        SET s3_endpoint = 'minio:9000';
        SET s3_access_key_id = '{ACCESS_KEY}';
        SET s3_secret_access_key = '{SECRET_KEY}';
        SET s3_use_ssl = FALSE;

        COPY
        (
            SELECT
                *
            FROM
                read_csv_auto('https://earthquake.usgs.gov/fdsnws/event/1/query?format=csv&starttime={start_date}&endtime={end_date}') AS res
        ) TO 's3://prod/{LAYER}/{SOURCE}/{start_date}/{start_date}_00-00-00.gz.parquet';

        """,)

    con.close()
    logging.info(f"‚úÖ Download for date success: {start_date}")


with DAG(
    dag_id=DAG_ID,
    schedule_interval="0 5 * * *",
    default_args=args,
    tags=["s3", "raw"],
    description=SHORT_DESCRIPTION,
    concurrency=1,
    max_active_tasks=1,
    max_active_runs=1,
) as dag:
    dag.doc_md = LONG_DESCRIPTION

    start = EmptyOperator(
        task_id="start",
    )

    get_and_transfer_api_data_to_s3 = PythonOperator(
        task_id="get_and_transfer_api_data_to_s3",
        python_callable=get_and_transfer_api_data_to_s3,
    )

    end = EmptyOperator(
        task_id="end",
    )

    start >> get_and_transfer_api_data_to_s3 >> end
```

–ü–æ—Å–ª–µ —á–µ–≥–æ –æ–±–Ω–æ–≤–ª—è—é UI Airflow –∏ –≤–∏–∂—É –æ—à–∏–±–∫—É:

<img width="814" height="295" alt="image" src="https://github.com/user-attachments/assets/365e0846-1f98-42cc-ab2e-1172198bad64" />

–†—É–≥–∞–µ—Ç—Å—è –Ω–∞ —Ç–æ, —á—Ç–æ –∫–ª—é—á–µ–π –Ω–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç. –î–ª—è —ç—Ç–æ–≥–æ –ø–µ—Ä–µ—Ö–æ–∂—É –≤ Admin->Variables –∏ —Å–æ–∑–¥–∞—é –Ω–æ–≤—ã–π –∞—Ç—Ä–∏–±—É—Ç:

<img width="780" height="444" alt="image" src="https://github.com/user-attachments/assets/0015274f-3e05-4e0b-8bc4-74d5ed3b2d6e" />

<img width="853" height="463" alt="image" src="https://github.com/user-attachments/assets/2653454e-64e8-4765-8fea-fd9a7b4a6a5f" />

<img width="1391" height="527" alt="image" src="https://github.com/user-attachments/assets/e30782a9-05b6-41c7-99eb-7eb10b2a44bc" />

–û–±–Ω–æ–≤–ª—è—é –∏ –≤–∏–∂—É —á—Ç–æ –ø–æ—è–≤–∏–ª—Å—è –¥–∞–≥ –∏ –ø—Ä–æ–ø–∞–ª–∞ –æ—à–∏–±–∫–∞

<img width="1889" height="402" alt="image" src="https://github.com/user-attachments/assets/35d482a3-1085-4609-aa85-1389a612fbf2" />

–ï—Å–ª–∏ –∫–ª–∏–∫–Ω–µ–º –Ω–∞ —Ç–∞—Å–∫—É —Ç–æ —É–≤–∏–¥–∏–º –ª–æ–≥–∏ –∏ —Ç–æ —á—Ç–æ –∑–∞–≥—Ä—É–∑–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞

<img width="1876" height="587" alt="image" src="https://github.com/user-attachments/assets/df41e43b-8766-48d8-a767-6e5fb63e2073" />

–¢–∞–∫ –∂–µ —É–≤–∏–¥–∏–º –≤ MINIO

<img width="1889" height="447" alt="image" src="https://github.com/user-attachments/assets/d4a39c58-8e7c-4cb9-9b7c-8404b9eb2b68" />

<img width="1866" height="393" alt="image" src="https://github.com/user-attachments/assets/4849f7fb-eefd-4f74-b11f-694a2a1eacf8" />

–ó–∞–≥—Ä—É–∑–∫–∞ –∏–Ω–∫—Ä–∏–º–µ–Ω—Ç–∞–ª—å–Ω–æ –∑–∞ –≤—á–µ—Ä–∞. –ò –≤—Å–µ –ø—Ä–æ–∏—Å—Ö–æ–¥–∏—Ç –∏–¥–µ–º–ø–æ—Ç–µ–Ω—Ç–Ω–æ.

–¢–æ –µ—Å—Ç—å –µ—Å–ª–∏ –æ—á–∏—Å—Ç–∏–º —Ç–∞—Å–∫

<img width="1883" height="587" alt="image" src="https://github.com/user-attachments/assets/0ecbc965-a1bf-4d9c-a7d9-2356f3ae2cfa" />

<img width="1892" height="601" alt="image" src="https://github.com/user-attachments/assets/19c81c39-6f1b-46ba-a816-7b4c9060db73" />

–¢–æ –æ–Ω –ø–µ—Ä–µ—Ç—Ä–µ—Ç –¥–∞–Ω–Ω—ã–µ –∏ –æ–ø—è—Ç—å –∑–∞–≥—Ä—É–∑–∏—Ç —Ç–æ–∂–µ —Å–∞–º–æ–µ —á—Ç–æ –∏ –±—ã–ª–æ –∑–∞ —ç—Ç—É –¥–∞—Ç—É.

–ò –µ—Å–ª–∏ –ø–æ—Å–º–æ—Ç—Ä–µ—Ç—å –Ω–∞ –¥–∞–Ω–Ω—ã–µ –∑–∞ 20-11-2025 —Ç–æ –æ–Ω–∏ –±—É–¥—É—Ç —Å–≤–µ–∂–µ–µ (Last Modified) —á–µ–º –∑–∞ 23-11-2025

<img width="1640" height="239" alt="image" src="https://github.com/user-attachments/assets/ec4aa90c-aaa7-4cf3-9ba6-d4359261b15a" />

<img width="1613" height="252" alt="image" src="https://github.com/user-attachments/assets/8b3e1d4d-9885-4617-b5ad-63609b344c6e" />


–¢–æ–µ—Å—Ç—å –±–ª–∞–≥–æ–¥–∞—Ä—è –∫–æ–Ω—Ç–µ–∫—Å—Ç—É –º—ã —Å–æ–∑–¥–∞–ª–∏ –∏–¥–µ–º–ø–æ—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å.

## –°–æ–∑–¥–∞–Ω–∏–µ –≤—Ç–æ—Ä–æ–≥–æ DAG

`raw_from_s3_to_pg.py`

–í –¥–∞–Ω–Ω–æ–º –¥–∞–≥–µ –±—É–¥–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è –∫–æ–Ω—Ü–µ–ø—Ü–∏—è —Å–µ–Ω—Å–æ—Ä–∞ `ExternalTaskSensor` ‚Äî —ç—Ç–æ —Å–µ–Ω—Å–æ—Ä –≤ Apache Airflow, –∫–æ—Ç–æ—Ä—ã–π –æ–∂–∏–¥–∞–µ—Ç –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –∑–∞–¥–∞—á–∏ –≤ –¥—Ä—É–≥–æ–º DAG. –°–µ–Ω—Å–æ—Ä (Sensor) –≤ Apache Airflow ‚Äî —ç—Ç–æ —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã–π —Ç–∏–ø –æ–ø–µ—Ä–∞—Ç–æ—Ä–∞, –∫–æ—Ç–æ—Ä—ã–π –æ–∂–∏–¥–∞–µ—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω–æ–≥–æ —É—Å–ª–æ–≤–∏—è –ø–µ—Ä–µ–¥ –ø—Ä–æ–¥–æ–ª–∂–µ–Ω–∏–µ–º –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è DAG. –ü–æ —Å—Ç—Ä—É–∫—Ç—É—Ä–µ –≤—Ç–æ—Ä–æ–π –¥–∞–≥ –ø–æ—Ö–æ–∂ –Ω–∞ –ø–µ—Ä–≤—ã–π –¥–∞–≥.

–î–ª—è –Ω–∞—á–∞–ª–∞ —Å–æ–∑–¥–∞—é –∫–ª—é—á `pg_password`. –ü–µ—Ä–µ—Ö–æ–∂—É –≤ UI Airflow, Admin -> Variables

<img width="777" height="465" alt="image" src="https://github.com/user-attachments/assets/ea50d9fa-c62e-466f-86c3-aa51b4c018fe" />

–ò—Å–ø–æ–ª—å–∑—É—é —Å–∏–Ω—Ç–∞–∫—Å–∏—Å DuckDB. –°–æ–∑–¥–∞—é `SECRET dwh_postgres`.

–≠—Ç–æ —Ñ—É–Ω–∫—Ü–∏–∏ DuckDB –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –≤–Ω–µ—à–Ω–∏–º–∏ –∏—Å—Ç–æ—á–Ω–∏–∫–∞–º–∏ –¥–∞–Ω–Ω—ã—Ö –∏ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Å–µ–∫—Ä–µ—Ç–∞–º–∏.

SECRET –ø–æ–∑–≤–æ–ª—è–µ—Ç –±–µ–∑–æ–ø–∞—Å–Ω–æ —Ö—Ä–∞–Ω–∏—Ç—å —É—á–µ—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –¥–ª—è –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ –≤–Ω–µ—à–Ω–∏–º —Å–∏—Å—Ç–µ–º–∞–º:

```
CREATE SECRET dwh_postgres (
            TYPE postgres,
            HOST 'postgres_dwh',
            PORT 5432,
            DATABASE postgres,
            USER 'postgres',
            PASSWORD '{PASSWORD}'
        );
```

–ß—Ç–æ –¥–µ–ª–∞–µ—Ç: –°–æ–∑–¥–∞–µ—Ç –∏–º–µ–Ω–æ–≤–∞–Ω–Ω—ã–π —Å–µ–∫—Ä–µ—Ç dwh_postgres —Å –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ PostgreSQL. –•—Ä–∞–Ω–∏—Ç —á—É–≤—Å—Ç–≤–∏—Ç–µ–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ (–ø–∞—Ä–æ–ª–∏) –≤ –∑–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω–Ω–æ–º –≤–∏–¥–µ. –ò—Å–∫–ª—é—á–∞–µ—Ç –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç—å —Ö—Ä–∞–Ω–µ–Ω–∏—è –ø–∞—Ä–æ–ª–µ–π –≤ –æ—Ç–∫—Ä—ã—Ç–æ–º –≤–∏–¥–µ –≤ –∫–æ–¥–µ.

–ü–∞—Ä–æ–ª—å –∑–∞–±–∏—Ä–∞—é –∏–∑ UI Airflow —Å –ø–æ–º–æ—â—å—é `PASSWORD = Variable.get("pg_password")`

ATTACH –ø–æ–¥–∫–ª—é—á–∞–µ—Ç –≤–Ω–µ—à–Ω—é—é –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö –∫–∞–∫ —Å—Ö–µ–º—É –≤ —Ç–µ–∫—É—â–µ–π —Å–µ—Å—Å–∏–∏ DuckDB: `ATTACH '' AS dwh_postgres_db (TYPE postgres, SECRET dwh_postgres);`

–ß—Ç–æ –¥–µ–ª–∞–µ—Ç: –ü–æ–¥–∫–ª—é—á–∞–µ—Ç—Å—è –∫ PostgreSQL –∏—Å–ø–æ–ª—å–∑—É—è —Ä–∞–Ω–µ–µ —Å–æ–∑–¥–∞–Ω–Ω—ã–π —Å–µ–∫—Ä–µ—Ç `dwh_postgres`. –°–æ–∑–¥–∞–µ—Ç –ø—Å–µ–≤–¥–æ–Ω–∏–º `dwh_postgres_db` –¥–ª—è —É–¥–∞–ª–µ–Ω–Ω–æ–π –ë–î. –ü–æ–∑–≤–æ–ª—è–µ—Ç —Ä–∞–±–æ—Ç–∞—Ç—å —Å —Ç–∞–±–ª–∏—Ü–∞–º–∏ PostgreSQL –∫–∞–∫ —Å –ª–æ–∫–∞–ª—å–Ω—ã–º–∏ —Ç–∞–±–ª–∏—Ü–∞–º–∏ DuckDB.

–¢.–µ –∫–æ–¥ –≤ `con.sql(.....)` –¥–µ–ª–∞–µ—Ç —Å–ª–µ–¥—É—é—â–µ–µ: –ù–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ MinIO (S3-—Å–æ–≤–º–µ—Å—Ç–∏–º–æ–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–µ). –°–æ–∑–¥–∞–µ—Ç —Å–µ–∫—Ä–µ—Ç –¥–ª—è PostgreSQL DWH. –ü–æ–¥–∫–ª—é—á–∞–µ—Ç PostgreSQL –∫–∞–∫ –≤–Ω–µ—à–Ω—é—é –ë–î –ø–æ–¥ –∏–º–µ–Ω–µ–º `dwh_postgres_db`. –í—Å—Ç–∞–≤–ª—è–µ—Ç –¥–∞–Ω–Ω—ã–µ –∏–∑ DuckDB –≤ —Ç–∞–±–ª–∏—Ü—É PostgreSQL.

–í UI Airflow -> Browse -> DAG Dependencies –º–æ–∂–Ω–æ —É–≤–∏–¥–µ—Ç—å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å –¥–∞–≥–æ–≤.

<img width="820" height="287" alt="image" src="https://github.com/user-attachments/assets/56246e17-4df7-4439-94c7-b68f76ae5040" />

–¢–æ–µ—Å—Ç—å –¥–∞–≥ `raw_from_s3_to_pg` –∑–∞–≤–∏—Å–∏—Ç –æ—Ç –¥–∞–≥–∞ `raw_from_api_to_s3` –Ω–∞ –æ—Å–Ω–æ–≤–µ —Å–µ–Ω—Å–æ—Ä–∞ `sensor_on_raw_layer`

–¢–∞–∫ –∂–µ –ø–µ—Ä–µ–¥ –∑–∞–ø—É—Å–∫–æ–º –¥–∞–≥–∞, –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ —Å–æ–∑–¥–∞—Ç—å –º–æ–¥–µ–ª—å –¥–∞–Ω–Ω—ã—Ö —Å –∫–æ—Ç–æ—Ä–æ–π –±—É–¥–µ–º —Ä–∞–±–æ—Ç–∞—Ç—å. –î–ª—è —ç—Ç–æ–≥–æ –æ—Ç–∫—Ä—ã–≤–∞—é DBeaver.

–°–æ–∑–¥–∞–µ–º —Å—Ö–µ–º—ã:

```
CREATE SCHEMA stg;
CREATE SCHEMA ods;
CREATE SCHEMA dm;
```

<img width="256" height="147" alt="image" src="https://github.com/user-attachments/assets/7d1594a0-1b94-4e94-905e-34ba3dad072a" />

–°–æ–∑–¥–∞—é —Ç–∞–±–ª–∏—Ü—ã:

DDL ods.fct_earthquake:

```
DDL ods.fct_earthquake:

CREATE TABLE ods.fct_earthquake
(
	time varchar,
	latitude varchar,
	longitude varchar,
	depth varchar,
	mag varchar,
	mag_type varchar,
	nst varchar,
	gap varchar,
	dmin varchar,
	rms varchar,
	net varchar,
	id varchar,
	updated varchar,
	place varchar,
	type varchar,
	horizontal_error varchar,
	depth_error varchar,
	mag_error varchar,
	mag_nst varchar,
	status varchar,
	location_source varchar,
	mag_source varchar
)
```

–ß—Ç–æ–±—ã –Ω–µ —Ç—Ä–∞—Ç–∏—Ç—å –≤—Ä–µ–º—è, –≤—Å–µ —Ç–∏–ø—ã –ø—Ä–∏–≤–µ–ª –∫ Varchar (–õ—É—á—à–µ —Ç–∞–∫ –Ω–µ –¥–µ–ª–∞—Ç—å).

–ó–∞–ø—É—Å–∫–∞–µ–º –¥–∞–≥ `raw_from_s3_to_pg`. –¢–∞–∫ –∂–µ, –¥–µ–ª–∞—é –Ω–µ —Ä—É—á–Ω–æ–π –∑–∞–ø—É—Å–∫. –ê –ø—Ä–æ—Å—Ç–æ –ø—Ä–æ–≤–∞–ª–∏–≤–∞—é—Å—å –≤ –¥–∞–≥ –∏ –≤–∏–∂—É –∫–∞–∫ –æ–Ω –æ—Ç—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç. –ö–∞–∫ —Ç–æ–ª—å–∫–æ –Ω–∞—á–∏–Ω–∞–µ—Ç –æ—Ç—Ä–∞–±–∞—Ç—ã–≤–∞—Ç—å —ç—Ç–æ—Ç –¥–∞–≥, –æ–Ω –≤—ã–ø–æ–ª–Ω—è–µ—Ç –¥–æ–ø —Ç–∞—Å–∫—É –≤ –≤–∏–¥–µ —Å–µ–Ω—Å–æ—Ä–∞.

<img width="1895" height="532" alt="image" src="https://github.com/user-attachments/assets/210b9739-4e5b-41e4-be43-44e7ae8d4878" />

–°–µ–Ω—Å–æ—Ä –∂–¥–µ—Ç —Å–æ—Å—Ç–æ—è–Ω–∏–µ —É—Å–ø–µ—Ö–∞ –¥–ª—è –ø–µ—Ä–≤–æ–≥–æ –¥–∞–≥–∞. –ú–æ–∂–Ω–æ –Ω–∞–∂–∞—Ç—å External Dag –∏ –æ–±—Ä–∞—Ç–∏—Ç—å—Å—è –∫ —Ç–æ–º—É –¥–∞–≥—É –∫–æ—Ç–æ—Ä—ã–π —Å–µ–Ω—Å–æ—Ä —Å–º–æ—Ç—Ä–∏—Ç.

<img width="1876" height="739" alt="image" src="https://github.com/user-attachments/assets/d09634ab-a4e7-4009-824c-8113f57f4e4e" />

–í–∞–∂–Ω–æ–µ —Å–≤–æ–π—Å—Ç–≤–æ —Å–µ–Ω—Å–æ—Ä–∞ –≤ —Ç–æ–º —á—Ç–æ, –µ—Å–ª–∏ –ø–µ—Ä–≤—ã–π –¥–∞–≥ –Ω–µ –æ—Ç—Ä–∞–±–æ—Ç–∞–ª, —Ç–æ –≤—Ç–æ—Ä–æ–π –¥–∞–≥ –Ω–µ –Ω–∞—á–Ω–µ—Ç —Å–≤–æ—é —Ä–∞–±–æ—Ç—É.

–í–∏–¥–∏–º –∫–∞–∫ –≤—Å–µ –æ—Ç—Ä–∞–±–æ—Ç–∞–ª–æ.

<img width="1857" height="612" alt="image" src="https://github.com/user-attachments/assets/88a32178-d16b-4d09-95f8-8be516c66bd2" />

–ü—Ä–æ–≤–µ—Ä—è—é, –¥–æ–±–∞–≤–∏–ª–∏—Å—å –ª–∏ –¥–∞–Ω–Ω—ã–µ –≤ postgre. –í–∏–∂—É, —á—Ç–æ –¥–æ–±–∞–≤–ª–µ–Ω—ã –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –¥–∞—Ç—ã –∏ —Å–ª–µ–¥—É—é—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Å—Ç—Ä–æ–∫

<img width="443" height="221" alt="image" src="https://github.com/user-attachments/assets/9cae81d1-f973-4449-93f3-484c5ac99ab2" />

<img width="264" height="163" alt="image" src="https://github.com/user-attachments/assets/176677b2-64b1-42bd-be6f-5941bedfc0c0" />

<img width="1894" height="368" alt="image" src="https://github.com/user-attachments/assets/570a7a3a-4911-41a4-8a97-b5780bb0c753" />

## –°–æ–±–∏—Ä–∞—é –≤–∏—Ç—Ä–∏–Ω—É - —Ç—Ä–µ—Ç–∏–π DAG

`fct_count_day_earthquake.py`

–ò—Å–ø–æ–ª—å–∑—É—é `SQLExecuteQueryOperator`. –í –¥–∞–Ω–Ω–æ–º —Å–∫—Ä–∏–ø—Ç–µ –Ω–µ –∏—Å–ø–æ–ª—å–∑—É—é –ø–∏—Ç–æ–Ω–æ–≤—Å–∫–∏—Ö —Ñ—É–Ω–∫—Ü–∏–π. –ù–æ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–∞–≥–∞ —Ç–∞–∫–∞—è –∂–µ –∫–∞–∫ –∏ —Ä–∞–Ω–µ–µ. –ï—Å—Ç—å –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ —Å–æ —Å–ª–æ—è–º–∏, —Å–æ–µ–¥–∏–Ω–∏—è–º–∏ –∏ —Ç–¥. –í –¥–∞–Ω–Ω–æ–º —Å–ª—É—á–∞–µ DuckDB –∏ python –Ω–∏–∫–∞–∫ –Ω–µ —É—á–∏—Ç—ã–≤–∞—é—Ç—Å—è. –°–µ–π—á–∞—Å —Ä–∞–±–æ—Ç–∞—é —Ç–æ–ª—å–∫–æ —Å postgre.

–í –∫–æ–¥–µ —Ç–∞–∫ –∂–µ –∏—Å–ø–æ–ª—å–∑—É—é —Å–µ–Ω—Å–æ—Ä, –∫–æ—Ç–æ—Ä—ã–π —Å—Å—ã–ª–∞–µ—Ç—Å—è –Ω–∞ –¥–∞–≥ `external_dag_id="raw_from_s3_to_pg"` –∏ –∑–∞–Ω–∏–º–∞–µ—Ç—Å—è –ø–µ—Ä–µ–≥—Ä—É–∑–∫–æ–π –¥–∞–Ω–Ω—ã—Ö –≤ postgre.

`task_id="drop_stg_table_before"` - –ü–µ—Ä–µ–¥ —Ç–µ–º –∫–∞–∫ —Å–æ–∑–¥–∞—Ç—å –≤–∏—Ç—Ä–∏–Ω—É, –º—ã —Å–æ–∑–¥–∞–µ–º tmp —Ç–∞–±–ª–∏—Ü—É 'task_id="create_stg_table"' –≤ —Å–ª–æ–µ `stg` –≤ –∫–æ—Ç–æ—Ä–æ–º –±—É–¥—É—Ç —Ö—Ä–∞–Ω–∏—Ç—Å—è –¥–∞–Ω–Ω—ã–µ. 

–î–∞–ª–µ–µ –¥–ª—è –∏–¥–µ–º–ø–æ—Ç–µ–Ω—Ç–Ω–æ—Å—Ç–∏ –∏—Å–ø–æ–ª—å–∑—É—é `task_id="drop_from_target_table". –¢–æ–µ—Å—Ç—å –Ω–∞–ø—Ä–∏–º–µ—Ä —É –Ω–∞—Å —Å–µ–π—á–∞—Å –µ—Å—Ç—å –¥–∞–Ω–Ω—ã–µ —Å 1 –ø–æ 8 –º–∞—è –∏ –º—ã —Ö–æ—Ç–∏–º –ø–µ—Ä–µ–≥—Ä—É–∑–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –∑–∞ 5 –º–∞—è, –ø–æ—Ç–æ–º—É —á—Ç–æ —É –Ω–∞—Å –ø—Ä–∏–ª–µ—Ç–∏–ª–∏ –Ω–∞–ø—Ä–∏–º–µ—Ä –∫–∞–∫–∏–µ —Ç–æ –¥–æ–ª–µ—Ç—ã –∏–ª–∏ –Ω–æ–≤—ã–µ –∑–µ–º–ª–µ—Ç—Ä—è—Å–µ–Ω–∏—è. –¢–æ –º—ã –ø—Ä–æ—Å—Ç–æ –ø–µ—Ä–µ–≥—Ä—É–∂–∞–µ–º –∑–∞ 5 –º–∞—è –∏ –¥–ª—è —Ç–æ–≥–æ —á—Ç–æ–±—ã –∏—Å–∫–ª—é—á–∏—Ç—å –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ, –º—ã —É–¥–∞–ª—è–µ–º –∏–º–µ–Ω–Ω–æ —ç—Ç–æ—Ç –¥–µ–Ω—å –∏ –≤—Å—Ç–∞–≤–ª—è–µ–º –µ–≥–æ –∑–∞–Ω–æ–≤–æ.

–î–µ–ª–∞—é –≤—Å—Ç–∞–≤–∫—É `task_id="insert_into_target_table"`. –ù–∞–ø—Ä–∏–º–µ—Ä –µ—Å–ª–∏ –º—ã —É–¥–∞–ª–∏–ª–∏ 5 –º–∞—è, —Ç–æ –º—ã —Å—Ä–∞–∑—É –µ–≥–æ –≤—Å—Ç–∞–≤–ª—è–µ–º –∏–∑ –≤—Ä–µ–º–µ–Ω–Ω–æ–π —Ç–∞–±–ª–∏—Ü—ã –∏ —Å—Ä–∞–∑—É —É–¥–∞–ª—è–µ–º –≤—Ä–µ–º–µ–Ω–Ω—É—é —Ç–∞–±–ª–∏—Ü—É `task_id="drop_stg_table_after"`

–ü–µ—Ä–µ–¥ –∑–∞–ø—É—Å–∫–æ–º –¥–∞–≥–æ–≤ –Ω–∞–¥–æ —Å–æ–∑–¥–∞—Ç—å –∫–æ–Ω–Ω–µ–∫—Ç –≤ UI Airflow -> Admin -> Connections

<img width="1874" height="917" alt="image" src="https://github.com/user-attachments/assets/edc1b735-bf1d-4afa-84e1-179fc06883a7" />

<img width="1872" height="455" alt="image" src="https://github.com/user-attachments/assets/ac5bc206-0295-48b1-bf01-74b924ffa9c9" />

–° —ç—Ç–æ–≥–æ –º–æ–º–µ–Ω—Ç–∞ –∏–º–µ—é –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ –ø–æ—Å—Ç–≥—Ä–µ, –∫–æ—Ç–æ—Ä–æ–µ –º–æ–≥—É –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –≤ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –¥–∞–≥–∞—Ö. –í–∞—Ä–∏–∞–Ω—Ç–æ–≤ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –µ—Å—Ç—å –º–Ω–æ–≥–æ.

–ü—Ä–æ–≤–∞–ª–∏–≤–∞—é—Å—å –≤ UI –≤ `DAG: fct_count_day_earthquake` –∏ –∑–∞–ø—É—Å–∫–∞—é. –ú–æ–∂–µ—Ç –ø–æ—è–≤–∏—Ç—Å—è –æ—à–∏–±–∫–∞, —Ç–∞–∫ –∫–∞–∫ –Ω–µ —Å–æ–∑–¥–∞–Ω–∞ —Ç–∞–±–ª–∏—Ü–∞.

<img width="1884" height="686" alt="image" src="https://github.com/user-attachments/assets/6556f9da-6ec2-480c-9fb2-4a07a36726b4" />

–î–ª—è —Å–æ–∑–¥–∞–Ω–∏—è —Ç–∞–±–ª–∏—Ü—ã –ø–µ—Ä–µ—Ö–æ–∂—É –≤ –¥–∏–±–∏–≤–µ—Ä –∏ –ø–∏—à—É.

DDL dm.fct_count_day_earthquake:

```
CREATE TABLE dm.fct_count_day_earthquake AS 
SELECT time::date AS date, count(*)
FROM ods.fct_earthquake
WHERE time::date = '2025-11-20'
GROUP BY 1
```
–ü–æ—Å–ª–µ —Å–æ–∑–¥–∞–Ω–∏—è –ø—Ä–æ–≤–µ—Ä—è—é –∏ –≤–∏–∂—É –¥–∞–Ω–Ω—ã–µ

<img width="722" height="436" alt="image" src="https://github.com/user-attachments/assets/ef905f70-efde-415b-be0f-20eb2b4e0931" />

–¢–µ–ø–µ—Ä—å –æ—á–∏—â–∞—é —Ç–∞—Å–∫—É —Å –æ—à–∏–±–∫–æ–π

<img width="1898" height="692" alt="image" src="https://github.com/user-attachments/assets/98b54f70-bdd8-4d8c-91b0-51e10d8ea9d4" />

–í–∏–∂—É —á—Ç–æ –æ—Ç—Ä–∞–±–æ—Ç–∞–ª–æ

<img width="1892" height="708" alt="image" src="https://github.com/user-attachments/assets/6804aa3e-21be-40e7-bd60-cf9e3e24eb75" />

–û–±–Ω–æ–≤–ª—è—é –∏ –≤–∏–∂—É —Ç–µ –∂–µ —Å–∞–º—ã–µ —á–∏—Å–ª–∞, –ø–æ—Ç–æ–º—É —á—Ç–æ —É –Ω–∞—Å –∏–¥–µ–º–ø–æ—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å.

<img width="304" height="194" alt="image" src="https://github.com/user-attachments/assets/eb1069c8-5073-47aa-915f-8991017ac94b" />

–¢–∞–∫ –∂–µ –º–æ–∂–Ω–æ –ø–æ—Å–º–æ—Ç—Ä–µ—Ç—å –≥—Ä–∞—Ñ

<img width="1906" height="677" alt="image" src="https://github.com/user-attachments/assets/fe6910b1-0c51-4baf-b2c3-e02f057675cb" />

–û—á–∏—Å—Ç–∏–≤ —Ç–∞—Å–∫—É –∑–∞ –∫–∞–∫—É—é —Ç–æ –¥–∞—Ç—É –º–æ–∂–Ω–æ –ø–æ—Å–º–æ—Ç—Ä–µ—Ç—å –∫–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç –∏–¥–µ–º–ø–æ—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å. –î–∞–Ω–Ω—ã–µ –±—É–¥—É—Ç –æ–¥–∏–Ω–∞–∫–æ–≤—ã–º–∏.

<img width="1869" height="680" alt="image" src="https://github.com/user-attachments/assets/ad3ac7da-8195-4c8d-86c2-2d8728c613a9" />

–¢–∞–∫ –∂–µ —Å–æ–∑–¥–∞—é –µ—â–µ –æ–¥–∏–Ω –¥–∞–≥ `fct_avg_day_earthquake.py`

–ü—Ä–∏–º–µ—Ä SQL –∑–∞–ø—Ä–æ—Å–∞ –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è —Ç–∞–±–ª–∏—Ü—ã

DDL dm.fct_avg_day_earthquake:

```
CREATE TABLE dm.fct_avg_day_earthquake AS
SELECT time::date AS date, avg(mag::float)
FROM ods.fct_earthquake
WHERE time::date = '2025-11-20'
GROUP BY 1 
```
–¢–∞–∫ –∂–µ –º–æ–∂–Ω–æ –ø–æ—Å–º–æ—Ç—Ä–µ—Ç—å –∑–∞–≤–∏—Å–∏–º–æ—Ç—å –¥–∞–≥–æ–≤

<img width="1878" height="390" alt="image" src="https://github.com/user-attachments/assets/4fc46500-603c-4a47-854b-4b1150776ca6" />

## Metabase

–ü–µ—Ä–µ—Ö–æ–∂—É –ø–æ –∞–¥—Ä–µ—Å—É `http://localhost:3000/setup`

–†–µ–≥–∏—Å—Ç—Ä–∏—Ä—É—é—Å—å. –ü–∞—Ä–æ–ª—å `testtest1`

<img width="717" height="779" alt="image" src="https://github.com/user-attachments/assets/f4737d72-ae2c-4a8f-9233-610eac7d3acb" />

–°—Ä–∞–∑—É –ø–æ–¥–∫–ª—é—á–∞—é –ë–î

<img width="581" height="877" alt="image" src="https://github.com/user-attachments/assets/d7cec840-84ed-42f7-beb5-b91d2943856e" />

–°–æ–∑–¥–∞—é –Ω–æ–≤—ã–π –¥–∞—à–±–æ—Ä–¥

<img width="1771" height="708" alt="image" src="https://github.com/user-attachments/assets/fc59e075-9402-4ff4-a2b0-ee679504ea34" />

<img width="554" height="258" alt="image" src="https://github.com/user-attachments/assets/897bc7b4-ee28-499e-8ee5-d455b85ce1e3" />

<img width="403" height="329" alt="image" src="https://github.com/user-attachments/assets/f62eccc0-d3d7-4f94-8566-dfcc77bf9aa4" />

<img width="1012" height="495" alt="image" src="https://github.com/user-attachments/assets/a57fb9bf-72d1-4645-8f7d-b12e0f6ece51" />

<img width="1917" height="569" alt="image" src="https://github.com/user-attachments/assets/0009964b-3f84-4392-b5a3-d864ec0e5d6c" />

<img width="637" height="500" alt="image" src="https://github.com/user-attachments/assets/3769f3af-2862-4624-a8dc-c544bb069af7" />

<img width="1902" height="949" alt="image" src="https://github.com/user-attachments/assets/60f8f545-f012-486e-8819-0db616aa2cbb" />

<img width="1920" height="914" alt="image" src="https://github.com/user-attachments/assets/24863162-0e49-4da0-ac20-e237ad360278" />

<img width="1525" height="732" alt="image" src="https://github.com/user-attachments/assets/d73b1b4b-6853-40b9-a1d4-6a53cbdf3d12" />

<img width="1901" height="518" alt="image" src="https://github.com/user-attachments/assets/25188f50-db81-478b-a3ed-f45a7bd677fc" />

–î–∞–ª–µ–µ —Ç–∞–∫ –∂–µ –Ω–∞–∂–∏–º–∞—é –ù–æ–≤—ã–π - –ú–æ–¥–µ–ª—å - –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Å–æ–±—Å—Ç–≤–µ–Ω–Ω—ã–π –∑–∞–ø—Ä–æ—Å. –ò —Å–æ–∑–¥–∞—é –º–æ–¥–µ–ª—å –Ω–∞ –æ—Å–Ω–æ–≤–µ —Ç–∞–±–ª–∏—Ü—ã: `dm.fct_count_day_earthquake`.

–î—É–±–ª–∏—Ä—É—é –≥—Ä–∞—Ñ–∏–∫–∏ –∏ –º–µ–Ω—è—é –∑–∞–ø—Ä–æ—Å.

<img width="1853" height="727" alt="image" src="https://github.com/user-attachments/assets/2909ca9a-ca7d-4a2d-b5cd-009baa434c24" />

–ù–∞–∂–∏–º–∞—é 

<img width="1327" height="394" alt="image" src="https://github.com/user-attachments/assets/06303533-e9a2-4b52-aabf-63489d855598" />

<img width="1894" height="650" alt="image" src="https://github.com/user-attachments/assets/9b92184b-28bd-41df-86f9-aab2558e8c84" />

–°–æ—Ö—Ä–∞–Ω—è—é –∫–∞–∫ –Ω–æ–≤—ã–π –∑–∞–ø—Ä–æ—Å

<img width="674" height="593" alt="image" src="https://github.com/user-attachments/assets/1c61ce19-3f55-44b3-8836-a29398a7b87c" />

–ü–æ–ª—É—á–∞—é –¥–∞—à–±–æ—Ä–¥

<img width="1875" height="845" alt="image" src="https://github.com/user-attachments/assets/146c49e1-2be6-4c5b-84c5-fdb234590d9c" />


## –ò—Ç–æ–≥

–ò—Ç–æ–≥–æ–≤–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

<img width="678" height="430" alt="image" src="https://github.com/user-attachments/assets/4740b586-53f2-46bf-88d7-a5c09853ba7d" />


## –û—à–∏–±–∫–∏

–ü—Ä–æ–±–ª–µ–º–∞ —Å `ExternalTaskSensor` –ø—Ä–∏ —Ä—É—á–Ω–æ–º –∑–∞–ø—É—Å–∫–µ DAG. –ü–æ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—é DAG –¥–æ–ª–∂–µ–Ω –∑–∞–ø—É—Å–∫–∞—Ç—å—Å—è –≤ 05:00 UTC. –°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ –µ—Å–ª–∏ –∑–∞–ø—É—Å–∫–∞—é –≤ —Ä—É—á–Ω—É—é —Ç–æ –ø–æ—è–≤–ª—è–µ—Ç—Å—è –µ—â–µ –æ–¥–∏–Ω —Ä—É—á–Ω–æ–π –∑–∞–ø—É—Å–∫.

–û–ø–∏—Å–∞–Ω–∏–µ

–í DAG –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `ExternalTaskSensor` –¥–ª—è –æ–∂–∏–¥–∞–Ω–∏—è —É—Å–ø–µ—à–Ω–æ–≥–æ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –¥—Ä—É–≥–æ–≥–æ DAG (`raw_from_api_to_s3`). –°–æ—Ö—Ä–∞–Ω—è—é.

–ü—Ä–∏ `scheduled run` (scheduled__YYYY-MM-DD...) —Å–µ–Ω—Å–æ—Ä –æ—Ç—Ä–∞–±–∞—Ç—ã–≤–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ.

–ü—Ä–∏ `manual run` (manual__YYYY-MM-DD...) —Å–µ–Ω—Å–æ—Ä –≤–∏—Å–∏—Ç –≤ —Å—Ç–∞—Ç—É—Å–µ `up_for_reschedule` –∏ –Ω–∏–∫–æ–≥–¥–∞ –Ω–µ –ø–µ—Ä–µ—Ö–æ–¥–∏—Ç –≤ `success`, —Ö–æ—Ç—è —Ü–µ–ª–µ–≤–æ–π DAG —É–∂–µ –∑–∞–≤–µ—Ä—à—ë–Ω.

<img width="1873" height="627" alt="image" src="https://github.com/user-attachments/assets/7b79c45d-e41c-4cb2-b4cc-cae330d450d3" />

<img width="1866" height="671" alt="image" src="https://github.com/user-attachments/assets/37eb39b5-d3b9-48e7-9b88-d8eda671cb2c" />

<img width="1882" height="737" alt="image" src="https://github.com/user-attachments/assets/6c0b508e-ad22-413a-b2ca-d727e57d20ae" />

<img width="1892" height="705" alt="image" src="https://github.com/user-attachments/assets/48eab82d-f41d-4df6-8bce-f348123ce297" />

–í UI Airflow: –°–µ–Ω—Å–æ—Ä —É—Å–ø–µ—à–µ–Ω –¥–ª—è `scheduled run`:

```
Run ID: scheduled__2025-11-20T05:00:00+00:00
Status: success
```

–°–µ–Ω—Å–æ—Ä –∑–∞–≤–∏—Å–∞–µ—Ç –¥–ª—è `manual run`:

```
Run ID: manual__2025-11-24T12:37:08.894410+00:00
Status: up_for_reschedule
```

–†–µ—à–µ–Ω–∏–µ:

–°–¥–µ–ª–∞–ª –Ω–µ —Ä—É—á–Ω–æ–π –∑–∞–ø—É—Å–∫ DAG

<img width="1878" height="362" alt="image" src="https://github.com/user-attachments/assets/674160eb-47b4-4ffa-a1a6-49d670630db2" />

–ê –ø—Ä–æ–≤–∞–ª–∏–ª—Å—è –≤ —Å–∞–º –¥–∞–≥ –≤ UI Airflow –∏ –æ–Ω –∑–∞–ø—É—Å—Ç–∏–ª—Å—è –æ—Ç —Ç—É–¥–∞.

<img width="1881" height="599" alt="image" src="https://github.com/user-attachments/assets/5481dc96-26e6-4212-90ad-39d1f46eedd3" />

–í —Ä–µ–∑—É–ª—å—Ç–∞—Ç–µ –ø–æ–ª—É—á–∏–ª 4 –∑–∞–ø—É—Å–∫–∞ –∫–∞–∫ –Ω–∞–¥–æ. —Å –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–º–∏ –¥–∞—Ç–∞–º–∏. –ó–∞–ø—É—Å–∫ –¥–µ–ª–∞–ª 24.11.2025. –î–∞–≥ —Å–æ–±—Ä–∞–ª –¥–∞–Ω–Ω—ã–µ –∑–∞ 

```
scheduled__2025-11-20T02:00:00+00:00
scheduled__2025-11-21T02:00:00+00:00
scheduled__2025-11-22T02:00:00+00:00
scheduled__2025-11-23T02:00:00+00:00
```
–≠—Ç–æ –ø–æ–π–¥–µ—Ç –≤ —Å–µ–Ω—Å–æ—Ä.
